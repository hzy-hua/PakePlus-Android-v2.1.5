<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“š æˆ‘çš„ä¹¦åº“ | ä¹¦ç±ç®¡ç†åŠ©æ‰‹</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #f94144;
            --card-bg: #ffffff;
            --shadow: rgba(0, 0, 0, 0.08);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: var(--border-radius);
            box-shadow: 0 8px 25px var(--shadow);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .logo {
            font-size: 3.5rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        h1 {
            color: var(--secondary);
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .tagline {
            font-size: 1.2rem;
            color: #666;
            max-width: 600px;
            margin: 0 auto;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: 0 6px 15px var(--shadow);
            display: flex;
            align-items: center;
            transition: var(--transition);
            border-left: 5px solid var(--primary);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-right: 20px;
            color: var(--primary);
        }

        .stat-info h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .stat-info p {
            color: #666;
            font-weight: 500;
        }

        .main-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: 0 8px 25px var(--shadow);
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-icon {
            font-size: 1.8rem;
            margin-right: 15px;
            color: var(--primary);
            background: rgba(67, 97, 238, 0.1);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-title {
            font-size: 1.5rem;
            color: var(--secondary);
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 14px 18px;
            font-size: 1rem;
            border: 2px solid #e1e5eb;
            border-radius: 8px;
            transition: var(--transition);
            background: #f8f9fa;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
            background: white;
        }

        .btn {
            display: inline-block;
            padding: 14px 28px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            width: 100%;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(67, 97, 238, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(108, 117, 125, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #38b000 0%, #2d7d46 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e63946 0%, #d00000 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ff9e00 0%, #ff9100 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #00b4d8 0%, #0077b6 100%);
            color: white;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9rem;
            width: auto;
        }

        .books-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
            border-radius: 8px;
            border: 1px solid #e1e5eb;
        }

        .book-item {
            padding: 15px;
            border-bottom: 1px solid #e1e5eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        .book-item:hover {
            background-color: #f8f9fa;
        }

        .book-item:last-child {
            border-bottom: none;
        }

        .book-info h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .book-meta {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .book-actions {
            display: flex;
            gap: 10px;
        }

        .search-result {
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }

        .result-found {
            background-color: rgba(76, 201, 240, 0.1);
            border-left: 4px solid var(--success);
        }

        .result-not-found {
            background-color: rgba(249, 65, 68, 0.1);
            border-left: 4px solid var(--danger);
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 40px;
        }

        .footer {
            text-align: center;
            margin-top: 60px;
            padding: 20px;
            color: #6c757d;
            font-size: 0.9rem;
            border-top: 1px solid #dee2e6;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }

        .empty-icon {
            font-size: 4rem;
            color: #adb5bd;
            margin-bottom: 20px;
        }

        .mobile-tip {
            display: none;
            background: rgba(67, 97, 238, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .books-table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .books-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .books-table th {
            background: var(--primary);
            color: white;
            font-weight: 600;
            text-align: left;
            padding: 15px;
            position: sticky;
            top: 0;
        }

        .books-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e1e5eb;
        }

        .books-table tr:hover {
            background-color: #f8f9fa;
        }

        .books-table tr:last-child td {
            border-bottom: none;
        }

        /* å¯¼å…¥å¯¼å‡ºåŒºåŸŸæ ·å¼ */
        .import-export-section {
            background: rgba(67, 97, 238, 0.05);
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
            border: 2px dashed rgba(67, 97, 238, 0.3);
        }

        .format-options {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .format-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 6px;
            background: white;
            border: 1px solid #dee2e6;
            cursor: pointer;
            transition: var(--transition);
        }

        .format-btn:hover {
            background: #f8f9fa;
            border-color: var(--primary);
        }

        .format-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .data-preview {
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e1e5eb;
            font-family: monospace;
            font-size: 0.9rem;
        }

        .template-download {
            margin-top: 20px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .mobile-tip {
                display: block;
            }
            
            .card {
                padding: 20px;
            }
            
            .format-options {
                flex-direction: column;
            }
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary);
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            overflow: auto;
            padding: 30px;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡µå¤´ -->
        <header class="fade-in">
            <div class="logo">
                <i class="fas fa-book-open"></i>
            </div>
            <h1>æˆ‘çš„ä¹¦åº“</h1>
            <p class="tagline">è®°å½•æ‚¨ä¹°è¿‡çš„æ¯ä¸€æœ¬ä¹¦ï¼Œè½»æ¾ç®¡ç†ä¸ªäººè—ä¹¦ï¼Œé¿å…é‡å¤è´­ä¹°</p>
        </header>

        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-cards fade-in">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-book"></i>
                </div>
                <div class="stat-info">
                    <h3 id="totalBooks">0</h3>
                    <p>è—ä¹¦æ€»æ•°</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <div class="stat-info">
                    <h3 id="last30Days">0</h3>
                    <p>æœ€è¿‘30å¤©æ–°å¢</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-star"></i>
                </div>
                <div class="stat-info">
                    <h3 id="thisYear">0</h3>
                    <p>ä»Šå¹´æ–°å¢</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-history"></i>
                </div>
                <div class="stat-info">
                    <h3 id="lastAdded">-</h3>
                    <p>æœ€è¿‘æ·»åŠ æ—¶é—´</p>
                </div>
            </div>
        </div>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- æ·»åŠ æ–°ä¹¦ -->
            <div class="card fade-in">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <h2 class="card-title">æ·»åŠ æ–°ä¹¦</h2>
                </div>
                
                <div class="form-group">
                    <label for="bookTitle"><i class="fas fa-heading"></i> ä¹¦å *</label>
                    <input type="text" id="bookTitle" class="form-control" placeholder="è¯·è¾“å…¥ä¹¦åï¼ˆå¿…å¡«ï¼‰" autocomplete="off">
                </div>
                
                <div class="form-group">
                    <label for="bookAuthor"><i class="fas fa-user-edit"></i> ä½œè€…</label>
                    <input type="text" id="bookAuthor" class="form-control" placeholder="ä½œè€…ï¼ˆå¯é€‰ï¼‰" autocomplete="off">
                </div>
                
                <div class="form-group">
                    <label for="purchaseDate"><i class="fas fa-calendar"></i> è´­ä¹°æ—¥æœŸ</label>
                    <input type="date" id="purchaseDate" class="form-control">
                </div>
                
                <button id="addBookBtn" class="btn btn-primary">
                    <i class="fas fa-save"></i> æ·»åŠ åˆ°ä¹¦åº“
                </button>
                
                <div id="duplicateWarning" style="display: none; margin-top: 15px; padding: 12px; background: rgba(255, 193, 7, 0.1); border-radius: 8px; border-left: 4px solid #ffc107;">
                    <i class="fas fa-exclamation-triangle"></i> è¿™æœ¬ä¹¦å·²ç»åœ¨æ‚¨çš„ä¹¦åº“ä¸­äº†ï¼
                </div>
            </div>

            <!-- æŸ¥è¯¢ä¹¦ç± -->
            <div class="card fade-in">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <h2 class="card-title">æŸ¥è¯¢ä¹¦ç±</h2>
                </div>
                
                <div class="form-group">
                    <label for="searchInput"><i class="fas fa-search"></i> è¾“å…¥ä¹¦åæŸ¥è¯¢</label>
                    <input type="text" id="searchInput" class="form-control" placeholder="è¾“å…¥ä¹¦åæˆ–ä½œè€…æŸ¥è¯¢æ˜¯å¦å·²è´­ä¹°" autocomplete="off">
                </div>
                
                <button id="searchBtn" class="btn btn-secondary">
                    <i class="fas fa-search"></i> æŸ¥è¯¢
                </button>
                
                <div id="searchResult" class="search-result">
                    <!-- æŸ¥è¯¢ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
        </div>

        <!-- ä¹¦ç±åˆ—è¡¨ -->
        <div class="card fade-in">
            <div class="card-header">
                <div class="card-icon">
                    <i class="fas fa-list"></i>
                </div>
                <h2 class="card-title">æˆ‘çš„è—ä¹¦åˆ—è¡¨</h2>
                <div style="margin-left: auto; display: flex; align-items: center; gap: 10px;">
                    <span style="background: var(--primary); color: white; padding: 5px 12px; border-radius: 20px; font-weight: 600;">
                        <i class="fas fa-book"></i> <span id="booksCount">0</span> æœ¬
                    </span>
                    <button class="btn btn-sm btn-info" onclick="toggleViewMode()" id="toggleViewBtn">
                        <i class="fas fa-table"></i> åˆ‡æ¢è¡¨æ ¼è§†å›¾
                    </button>
                </div>
            </div>
            
            <!-- å¡ç‰‡è§†å›¾ -->
            <div id="cardView" class="books-list">
                <div class="empty-state" id="emptyStateCard">
                    <div class="empty-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <h3>ä¹¦åº“ç©ºç©ºå¦‚ä¹Ÿ</h3>
                    <p>ç‚¹å‡»ä¸Šæ–¹"æ·»åŠ æ–°ä¹¦"å¼€å§‹è®°å½•æ‚¨çš„ç¬¬ä¸€æœ¬ä¹¦å§ï¼</p>
                </div>
            </div>
            
            <!-- è¡¨æ ¼è§†å›¾ -->
            <div id="tableView" class="books-table-container" style="display: none;">
                <table class="books-table">
                    <thead>
                        <tr>
                            <th width="5%">#</th>
                            <th width="45%">ä¹¦å</th>
                            <th width="25%">ä½œè€…</th>
                            <th width="15%">è´­ä¹°æ—¥æœŸ</th>
                            <th width="10%">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="booksTableBody">
                        <!-- è¡¨æ ¼æ•°æ®å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </tbody>
                </table>
                <div class="empty-state" id="emptyStateTable" style="display: none;">
                    <div class="empty-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <h3>ä¹¦åº“ç©ºç©ºå¦‚ä¹Ÿ</h3>
                    <p>ç‚¹å‡»ä¸Šæ–¹"æ·»åŠ æ–°ä¹¦"å¼€å§‹è®°å½•æ‚¨çš„ç¬¬ä¸€æœ¬ä¹¦å§ï¼</p>
                </div>
            </div>
        </div>

        <!-- å¯¼å…¥å¯¼å‡ºåŒºåŸŸ -->
        <div class="card fade-in import-export-section">
            <div class="card-header">
                <div class="card-icon">
                    <i class="fas fa-file-import"></i>
                </div>
                <h2 class="card-title">æ•°æ®å¯¼å…¥/å¯¼å‡º</h2>
            </div>
            
            <p style="margin-bottom: 15px;">æ”¯æŒå¤šç§æ ¼å¼å¯¼å…¥å¯¼å‡ºï¼Œæ¨èä½¿ç”¨Excel/CSVæ ¼å¼ï¼Œæ–¹ä¾¿åœ¨è¡¨æ ¼è½¯ä»¶ä¸­ç¼–è¾‘</p>
            
            <div class="format-options">
                <div class="format-btn active" data-format="csv" onclick="selectFormat('csv')">
                    <i class="fas fa-file-csv"></i> CSVæ ¼å¼
                </div>
                <div class="format-btn" data-format="excel" onclick="selectFormat('excel')">
                    <i class="fas fa-file-excel"></i> Excelæ ¼å¼
                </div>
                <div class="format-btn" data-format="json" onclick="selectFormat('json')">
                    <i class="fas fa-file-code"></i> JSONæ ¼å¼
                </div>
            </div>
            
            <div class="action-buttons" style="margin-top: 25px;">
                <button onclick="exportData()" class="btn btn-success">
                    <i class="fas fa-file-export"></i> å¯¼å‡ºä¹¦åº“æ•°æ®
                </button>
                <button onclick="importData()" class="btn btn-warning">
                    <i class="fas fa-file-import"></i> å¯¼å…¥ä¹¦åº“æ•°æ®
                </button>
                <button onclick="downloadTemplate()" class="btn btn-info">
                    <i class="fas fa-download"></i> ä¸‹è½½æ¨¡æ¿æ–‡ä»¶
                </button>
                <button onclick="showBatchAddModal()" class="btn btn-secondary">
                    <i class="fas fa-layer-group"></i> æ‰¹é‡æ·»åŠ ä¹¦ç±
                </button>
            </div>
            
            <div class="template-download">
                <p style="margin-top: 20px; font-size: 0.9rem; color: #666;">
                    <i class="fas fa-info-circle"></i> æç¤ºï¼šä¸‹è½½æ¨¡æ¿æ–‡ä»¶åï¼Œåœ¨Excelä¸­å¡«å†™ä¹¦ç±ä¿¡æ¯ï¼Œç„¶åä½¿ç”¨å¯¼å…¥åŠŸèƒ½
                </p>
            </div>
        </div>

        <!-- é¡µè„š -->
        <div class="footer fade-in">
            <p>Â© 2023 æˆ‘çš„ä¹¦åº“ | ä¹¦ç±ç®¡ç†åŠ©æ‰‹ | æ•°æ®å­˜å‚¨åœ¨æ‚¨çš„æµè§ˆå™¨æœ¬åœ°ï¼Œè¯·å®šæœŸå¤‡ä»½</p>
            <p style="margin-top: 10px; font-size: 0.8rem;">
                <i class="fas fa-info-circle"></i> æç¤ºï¼šæ•°æ®ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ä¸­ï¼Œæ¸…é™¤æµè§ˆå™¨æ•°æ®ä¼šä¸¢å¤±ä¹¦åº“ä¿¡æ¯ï¼Œè¯·å®šæœŸå¯¼å‡ºå¤‡ä»½
            </p>
        </div>
    </div>

    <!-- æ‰¹é‡æ·»åŠ æ¨¡æ€æ¡† -->
    <div class="modal" id="batchAddModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeBatchAddModal()">&times;</button>
            <h2 style="margin-bottom: 20px;"><i class="fas fa-layer-group"></i> æ‰¹é‡æ·»åŠ ä¹¦ç±</h2>
            
            <div class="form-group">
                <label>æ‰¹é‡è¾“å…¥ä¹¦ç±ï¼ˆæ¯è¡Œä¸€æœ¬ä¹¦ï¼Œæ ¼å¼ï¼šä¹¦å,ä½œè€…,è´­ä¹°æ—¥æœŸï¼‰</label>
                <textarea id="batchBooksInput" class="form-control" rows="10" placeholder="ç¤ºä¾‹ï¼š
çº¢æ¥¼æ¢¦,æ›¹é›ªèŠ¹,2023-10-15
æ´»ç€,ä½™å,2023-09-20
ä¸‰ä½“,åˆ˜æ…ˆæ¬£,2023-08-05

æ³¨æ„ï¼šæ¯è¡Œä¸€æœ¬ä¹¦ï¼Œä¹¦åå¿…å¡«ï¼Œä½œè€…å’Œè´­ä¹°æ—¥æœŸå¯é€‰ï¼Œç”¨é€—å·åˆ†éš”"></textarea>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 20px;">
                <button class="btn btn-success" onclick="processBatchAdd()">
                    <i class="fas fa-plus-circle"></i> æ‰¹é‡æ·»åŠ 
                </button>
                <button class="btn btn-secondary" onclick="closeBatchAddModal()">
                    <i class="fas fa-times"></i> å–æ¶ˆ
                </button>
            </div>
            
            <div id="batchAddResult" style="margin-top: 20px; display: none;">
                <!-- æ‰¹é‡æ·»åŠ ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentExportFormat = 'csv';
        let currentViewMode = 'card'; // 'card' æˆ– 'table'
        
        // ä»æœ¬åœ°å­˜å‚¨è·å–ä¹¦ç±æ•°æ®
        function getBooks() {
            const booksJson = localStorage.getItem('myBookLibrary');
            return booksJson ? JSON.parse(booksJson) : [];
        }
        
        // ä¿å­˜ä¹¦ç±æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveBooks(books) {
            localStorage.setItem('myBookLibrary', JSON.stringify(books));
            updateBookList();
            updateStatistics();
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®é»˜è®¤è´­ä¹°æ—¥æœŸä¸ºä»Šå¤©
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('purchaseDate').value = today;
            
            // åˆå§‹åŒ–ä¹¦ç±åˆ—è¡¨å’Œç»Ÿè®¡
            updateBookList();
            updateStatistics();
            
            // ç›‘å¬æ·»åŠ ä¹¦ç±æŒ‰é’®
            document.getElementById('addBookBtn').addEventListener('click', addBook);
            
            // ç›‘å¬æŸ¥è¯¢æŒ‰é’®
            document.getElementById('searchBtn').addEventListener('click', searchBook);
            
            // ç›‘å¬å›è½¦é”®
            document.getElementById('bookTitle').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addBook();
            });
            
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') searchBook();
            });
            
            // åˆå§‹åŒ–è§†å›¾æ¨¡å¼
            updateViewMode();
        });
        
        // é€‰æ‹©å¯¼å‡ºæ ¼å¼
        function selectFormat(format) {
            currentExportFormat = format;
            
            // æ›´æ–°æŒ‰é’®æ ·å¼
            document.querySelectorAll('.format-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.querySelector(`.format-btn[data-format="${format}"]`).classList.add('active');
        }
        
        // åˆ‡æ¢è§†å›¾æ¨¡å¼
        function toggleViewMode() {
            currentViewMode = currentViewMode === 'card' ? 'table' : 'card';
            updateViewMode();
        }
        
        // æ›´æ–°è§†å›¾æ¨¡å¼
        function updateViewMode() {
            const cardView = document.getElementById('cardView');
            const tableView = document.getElementById('tableView');
            const toggleBtn = document.getElementById('toggleViewBtn');
            
            if (currentViewMode === 'card') {
                cardView.style.display = 'block';
                tableView.style.display = 'none';
                toggleBtn.innerHTML = '<i class="fas fa-table"></i> åˆ‡æ¢è¡¨æ ¼è§†å›¾';
            } else {
                cardView.style.display = 'none';
                tableView.style.display = 'block';
                toggleBtn.innerHTML = '<i class="fas fa-list"></i> åˆ‡æ¢å¡ç‰‡è§†å›¾';
                updateTableView();
            }
        }
        
        // æ·»åŠ æ–°ä¹¦
        function addBook() {
            const title = document.getElementById('bookTitle').value.trim();
            const author = document.getElementById('bookAuthor').value.trim();
            const date = document.getElementById('purchaseDate').value;
            
            if (!title) {
                showMessage('è¯·è¾“å…¥ä¹¦å', 'warning');
                document.getElementById('bookTitle').focus();
                return;
            }
            
            const books = getBooks();
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
            const isDuplicate = books.some(book => 
                book.title.toLowerCase() === title.toLowerCase()
            );
            
            if (isDuplicate) {
                document.getElementById('duplicateWarning').style.display = 'block';
                
                // 3ç§’åè‡ªåŠ¨éšè—
                setTimeout(() => {
                    document.getElementById('duplicateWarning').style.display = 'none';
                }, 5000);
                
                if (!confirm('è¿™æœ¬ä¹¦å·²ç»åœ¨æ‚¨çš„ä¹¦åº“ä¸­äº†ï¼Œç¡®å®šè¦é‡å¤æ·»åŠ å—ï¼Ÿ')) {
                    return;
                }
            }
            
            // æ·»åŠ æ–°ä¹¦
            const newBook = {
                id: Date.now(),
                title: title,
                author: author || 'æœªçŸ¥ä½œè€…',
                purchaseDate: date || new Date().toISOString().split('T')[0],
                addDate: new Date().toISOString(),
                addDateDisplay: new Date().toLocaleDateString('zh-CN')
            };
            
            books.unshift(newBook); // æ·»åŠ åˆ°å¼€å¤´
            saveBooks(books);
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('bookTitle').value = '';
            document.getElementById('bookAuthor').value = '';
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            showMessage(`ã€Š${title}ã€‹å·²æˆåŠŸæ·»åŠ åˆ°ä¹¦åº“ï¼`, 'success');
        }
        
        // æŸ¥è¯¢ä¹¦ç±
        function searchBook() {
            const searchText = document.getElementById('searchInput').value.trim().toLowerCase();
            const resultDiv = document.getElementById('searchResult');
            
            if (!searchText) {
                showMessage('è¯·è¾“å…¥è¦æŸ¥è¯¢çš„ä¹¦åæˆ–ä½œè€…', 'warning');
                document.getElementById('searchInput').focus();
                return;
            }
            
            const books = getBooks();
            
            // æŸ¥æ‰¾åŒ¹é…çš„ä¹¦ç±
            const matchedBooks = books.filter(book => 
                book.title.toLowerCase().includes(searchText) ||
                book.author.toLowerCase().includes(searchText)
            );
            
            if (matchedBooks.length > 0) {
                resultDiv.className = 'search-result result-found';
                let html = `<h4><i class="fas fa-check-circle"></i> æ‰¾åˆ° ${matchedBooks.length} æœ¬ç›¸å…³ä¹¦ç±</h4>`;
                
                matchedBooks.forEach(book => {
                    html += `
                        <div style="margin-top: 10px; padding: 10px; background: white; border-radius: 6px;">
                            <div><strong>${book.title}</strong></div>
                            <div>ä½œè€…: ${book.author}</div>
                            <div style="font-size: 0.9rem; color: #6c757d;">æ·»åŠ æ—¥æœŸ: ${book.addDateDisplay}</div>
                        </div>
                    `;
                });
                
                resultDiv.innerHTML = html;
            } else {
                resultDiv.className = 'search-result result-not-found';
                resultDiv.innerHTML = `
                    <h4><i class="fas fa-times-circle"></i> æœªæ‰¾åˆ°ç›¸å…³ä¹¦ç±</h4>
                    <p>æ‚¨å¯èƒ½è¿˜æ²¡æœ‰è´­ä¹°è¿™æœ¬ä¹¦ï¼Œå¯ä»¥ç‚¹å‡»"æ·»åŠ æ–°ä¹¦"å°†å…¶åŠ å…¥ä¹¦åº“ã€‚</p>
                `;
            }
            
            resultDiv.style.display = 'block';
        }
        
        // æ›´æ–°ä¹¦ç±åˆ—è¡¨æ˜¾ç¤ºï¼ˆå¡ç‰‡è§†å›¾ï¼‰
        function updateBookList() {
            const books = getBooks();
            const cardView = document.getElementById('cardView');
            const emptyStateCard = document.getElementById('emptyStateCard');
            const booksCount = document.getElementById('booksCount');
            
            booksCount.textContent = books.length;
            
            if (books.length === 0) {
                if (!emptyStateCard) {
                    const emptyState = document.createElement('div');
                    emptyState.className = 'empty-state';
                    emptyState.id = 'emptyStateCard';
                    emptyState.innerHTML = `
                        <div class="empty-icon">
                            <i class="fas fa-book-open"></i>
                        </div>
                        <h3>ä¹¦åº“ç©ºç©ºå¦‚ä¹Ÿ</h3>
                        <p>ç‚¹å‡»ä¸Šæ–¹"æ·»åŠ æ–°ä¹¦"å¼€å§‹è®°å½•æ‚¨çš„ç¬¬ä¸€æœ¬ä¹¦å§ï¼</p>
                    `;
                    cardView.innerHTML = '';
                    cardView.appendChild(emptyState);
                } else {
                    emptyStateCard.style.display = 'block';
                }
                
                // æ›´æ–°è¡¨æ ¼è§†å›¾
                updateTableView();
                return;
            }
            
            // éšè—ç©ºçŠ¶æ€
            if (emptyStateCard) emptyStateCard.style.display = 'none';
            
            let html = '';
            books.forEach((book, index) => {
                html += `
                    <div class="book-item">
                        <div class="book-info">
                            <h4>${index + 1}. ${book.title}</h4>
                            <div class="book-meta">
                                <i class="fas fa-user"></i> ${book.author} 
                                <span style="margin-left: 15px;"><i class="fas fa-calendar"></i> ${book.purchaseDate}</span>
                                <span style="margin-left: 15px;"><i class="fas fa-clock"></i> ${book.addDateDisplay}</span>
                            </div>
                        </div>
                        <div class="book-actions">
                            <button class="btn btn-danger btn-sm" onclick="deleteBook(${book.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            cardView.innerHTML = html;
            
            // æ›´æ–°è¡¨æ ¼è§†å›¾
            updateTableView();
        }
        
        // æ›´æ–°è¡¨æ ¼è§†å›¾
        function updateTableView() {
            const books = getBooks();
            const tableBody = document.getElementById('booksTableBody');
            const emptyStateTable = document.getElementById('emptyStateTable');
            
            if (books.length === 0) {
                tableBody.innerHTML = '';
                if (emptyStateTable) emptyStateTable.style.display = 'block';
                return;
            }
            
            // éšè—ç©ºçŠ¶æ€
            if (emptyStateTable) emptyStateTable.style.display = 'none';
            
            let html = '';
            books.forEach((book, index) => {
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${book.title}</td>
                        <td>${book.author}</td>
                        <td>${book.purchaseDate}</td>
                        <td>
                            <button class="btn btn-danger btn-sm" onclick="deleteBook(${book.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }
        
        // åˆ é™¤ä¹¦ç±
        function deleteBook(id) {
            if (!confirm('ç¡®å®šè¦ä»ä¹¦åº“ä¸­åˆ é™¤è¿™æœ¬ä¹¦å—ï¼Ÿ')) return;
            
            let books = getBooks();
            books = books.filter(book => book.id !== id);
            saveBooks(books);
            
            showMessage('ä¹¦ç±å·²åˆ é™¤', 'success');
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStatistics() {
            const books = getBooks();
            const totalBooks = document.getElementById('totalBooks');
            const last30Days = document.getElementById('last30Days');
            const thisYear = document.getElementById('thisYear');
            const lastAdded = document.getElementById('lastAdded');
            
            // æ›´æ–°æ€»æ•°
            totalBooks.textContent = books.length;
            
            // è®¡ç®—æœ€è¿‘30å¤©æ–°å¢
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            
            const recentBooks = books.filter(book => {
                const bookDate = new Date(book.addDate);
                return bookDate >= thirtyDaysAgo;
            });
            
            last30Days.textContent = recentBooks.length;
            
            // è®¡ç®—ä»Šå¹´æ–°å¢
            const currentYear = new Date().getFullYear();
            const thisYearBooks = books.filter(book => {
                const bookDate = new Date(book.addDate);
                return bookDate.getFullYear() === currentYear;
            });
            
            thisYear.textContent = thisYearBooks.length;
            
            // æ›´æ–°æœ€è¿‘æ·»åŠ æ—¶é—´
            if (books.length > 0) {
                const latestBook = books[0];
                lastAdded.textContent = latestBook.addDateDisplay;
            } else {
                lastAdded.textContent = '-';
            }
        }
        
        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const books = getBooks();
            if (books.length === 0) {
                showMessage('ä¹¦åº“ä¸ºç©ºï¼Œæ²¡æœ‰æ•°æ®å¯ä»¥å¯¼å‡º', 'warning');
                return;
            }
            
            if (currentExportFormat === 'json') {
                exportAsJSON(books);
            } else if (currentExportFormat === 'csv') {
                exportAsCSV(books);
            } else if (currentExportFormat === 'excel') {
                exportAsExcel(books);
            }
        }
        
        // å¯¼å‡ºä¸ºJSONæ ¼å¼
        function exportAsJSON(books) {
            const dataStr = JSON.stringify(books, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `æˆ‘çš„ä¹¦åº“å¤‡ä»½_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showMessage(`å·²å¯¼å‡º ${books.length} æœ¬ä¹¦ç±æ•°æ® (JSONæ ¼å¼)`, 'success');
        }
        
        // å¯¼å‡ºä¸ºCSVæ ¼å¼
        function exportAsCSV(books) {
            // CSVæ ‡é¢˜è¡Œ
            let csvContent = "ä¹¦å,ä½œè€…,è´­ä¹°æ—¥æœŸ,æ·»åŠ æ—¥æœŸ\n";
            
            // æ·»åŠ æ•°æ®è¡Œ
            books.forEach(book => {
                const row = [
                    `"${book.title.replace(/"/g, '""')}"`,
                    `"${book.author.replace(/"/g, '""')}"`,
                    `"${book.purchaseDate}"`,
                    `"${book.addDateDisplay}"`
                ].join(',');
                csvContent += row + '\n';
            });
            
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `æˆ‘çš„ä¹¦åº“å¤‡ä»½_${new Date().toISOString().split('T')[0]}.csv`);
            link.click();
            
            showMessage(`å·²å¯¼å‡º ${books.length} æœ¬ä¹¦ç±æ•°æ® (CSVæ ¼å¼)`, 'success');
        }
        
        // å¯¼å‡ºä¸ºExcelæ ¼å¼ï¼ˆå®é™…ä¸Šä¹Ÿæ˜¯CSVï¼Œä½†ç”¨.xlsxæ‰©å±•åï¼‰
        function exportAsExcel(books) {
            // CSVå†…å®¹
            let csvContent = "ä¹¦å,ä½œè€…,è´­ä¹°æ—¥æœŸ,æ·»åŠ æ—¥æœŸ\n";
            
            // æ·»åŠ æ•°æ®è¡Œ
            books.forEach(book => {
                const row = [
                    `"${book.title.replace(/"/g, '""')}"`,
                    `"${book.author.replace(/"/g, '""')}"`,
                    `"${book.purchaseDate}"`,
                    `"${book.addDateDisplay}"`
                ].join(',');
                csvContent += row + '\n';
            });
            
            const blob = new Blob(['\ufeff' + csvContent], { type: 'application/vnd.ms-excel;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `æˆ‘çš„ä¹¦åº“å¤‡ä»½_${new Date().toISOString().split('T')[0]}.xlsx`);
            link.click();
            
            showMessage(`å·²å¯¼å‡º ${books.length} æœ¬ä¹¦ç±æ•°æ® (Excelæ ¼å¼)`, 'success');
        }
        
        // å¯¼å…¥æ•°æ®
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            
            // æ ¹æ®é€‰æ‹©çš„æ ¼å¼è®¾ç½®æ¥å—çš„æ–‡ä»¶ç±»å‹
            if (currentExportFormat === 'json') {
                input.accept = '.json';
            } else if (currentExportFormat === 'csv') {
                input.accept = '.csv,.txt';
            } else if (currentExportFormat === 'excel') {
                input.accept = '.xlsx,.xls,.csv';
            }
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        let importedBooks = [];
                        const fileContent = e.target.result;
                        
                        if (currentExportFormat === 'json') {
                            importedBooks = JSON.parse(fileContent);
                        } else {
                            // å¤„ç†CSVæˆ–Excelæ–‡ä»¶
                            importedBooks = parseCSV(fileContent);
                        }
                        
                        if (!Array.isArray(importedBooks)) {
                            throw new Error('æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
                        }
                        
                        if (confirm(`å¯¼å…¥ ${importedBooks.length} æœ¬ä¹¦ç±ï¼Œè¿™ä¼šè¦†ç›–ç°æœ‰ä¹¦åº“æ•°æ®ï¼Œç¡®å®šå—ï¼Ÿ`)) {
                            // ä¸ºå¯¼å…¥çš„ä¹¦ç±æ·»åŠ IDï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
                            const booksWithIds = importedBooks.map(book => {
                                if (!book.id) book.id = Date.now() + Math.random();
                                if (!book.addDateDisplay) {
                                    book.addDateDisplay = new Date().toLocaleDateString('zh-CN');
                                }
                                if (!book.addDate) {
                                    book.addDate = new Date().toISOString();
                                }
                                return book;
                            });
                            
                            localStorage.setItem('myBookLibrary', JSON.stringify(booksWithIds));
                            updateBookList();
                            updateStatistics();
                            showMessage(`æˆåŠŸå¯¼å…¥ ${booksWithIds.length} æœ¬ä¹¦ç±`, 'success');
                        }
                    } catch (error) {
                        console.error('å¯¼å…¥é”™è¯¯:', error);
                        showMessage('å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®æˆ–å†…å®¹æœ‰è¯¯', 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // è§£æCSVæ–‡ä»¶å†…å®¹ - ä¿®å¤ç‰ˆ
        function parseCSV(csvText) {
            const books = [];
            if (!csvText || csvText.trim() === '') {
                return books;
            }
            
            const lines = csvText.split(/\r?\n/);
            
            // å¦‚æœæ²¡æœ‰æ•°æ®è¡Œï¼Œè¿”å›ç©ºæ•°ç»„
            if (lines.length === 0) {
                return books;
            }
            
            // æ£€æŸ¥æ ‡é¢˜è¡Œï¼Œç¡®å®šèµ·å§‹è¡Œ
            let startIndex = 0;
            const firstLine = lines[0] || '';
            if (firstLine.includes('ä¹¦å') || firstLine.includes('title')) {
                startIndex = 1;
            }
            
            for (let i = startIndex; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                // ç®€å•çš„CSVè§£æ
                const columns = [];
                let currentColumn = '';
                let inQuotes = false;
                
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        columns.push(currentColumn.trim());
                        currentColumn = '';
                    } else {
                        currentColumn += char;
                    }
                }
                
                // æ·»åŠ æœ€åä¸€åˆ—
                columns.push(currentColumn.trim());
                
                // ç§»é™¤åˆ—ä¸­çš„å¼•å·
                const cleanedColumns = columns.map(col => 
                    col.replace(/^"|"$/g, '')
                );
                
                // ç¡®ä¿è‡³å°‘æœ‰ä¹¦å
                if (cleanedColumns[0] && cleanedColumns[0] !== '') {
                    const book = {
                        title: cleanedColumns[0],
                        author: cleanedColumns[1] || 'æœªçŸ¥ä½œè€…',
                        purchaseDate: cleanedColumns[2] || new Date().toISOString().split('T')[0]
                    };
                    
                    books.push(book);
                }
            }
            
            return books;
        }
        
        // ä¸‹è½½æ¨¡æ¿æ–‡ä»¶
        function downloadTemplate() {
            // åˆ›å»ºæ¨¡æ¿CSVå†…å®¹
            const templateContent = `ä¹¦å,ä½œè€…,è´­ä¹°æ—¥æœŸ
çº¢æ¥¼æ¢¦,æ›¹é›ªèŠ¹,2023-10-15
æ´»ç€,ä½™å,2023-09-20
ä¸‰ä½“,åˆ˜æ…ˆæ¬£,2023-08-05

æ³¨æ„ï¼š
1. æ¯è¡Œä»£è¡¨ä¸€æœ¬ä¹¦
2. "ä¹¦å"ä¸ºå¿…å¡«é¡¹
3. "ä½œè€…"å’Œ"è´­ä¹°æ—¥æœŸ"ä¸ºé€‰å¡«é¡¹
4. è´­ä¹°æ—¥æœŸæ ¼å¼ï¼šYYYY-MM-DD
5. å¡«å†™åä¿å­˜ä¸ºCSVæˆ–Excelæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨å¯¼å…¥åŠŸèƒ½`;
            
            const blob = new Blob(['\ufeff' + templateContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', 'ä¹¦ç±å¯¼å…¥æ¨¡æ¿.csv');
            link.click();
            
            showMessage('æ¨¡æ¿æ–‡ä»¶ä¸‹è½½æˆåŠŸ', 'success');
        }
        
        // æ˜¾ç¤ºæ‰¹é‡æ·»åŠ æ¨¡æ€æ¡†
        function showBatchAddModal() {
            document.getElementById('batchAddModal').style.display = 'flex';
            document.getElementById('batchAddResult').style.display = 'none';
            document.getElementById('batchBooksInput').value = '';
        }
        
        // å…³é—­æ‰¹é‡æ·»åŠ æ¨¡æ€æ¡†
        function closeBatchAddModal() {
            document.getElementById('batchAddModal').style.display = 'none';
        }
        
        // å¤„ç†æ‰¹é‡æ·»åŠ 
        function processBatchAdd() {
            const inputText = document.getElementById('batchBooksInput').value.trim();
            if (!inputText) {
                showMessage('è¯·è¾“å…¥è¦æ‰¹é‡æ·»åŠ çš„ä¹¦ç±', 'warning');
                return;
            }
            
            const lines = inputText.split('\n');
            const books = getBooks();
            const resultDiv = document.getElementById('batchAddResult');
            let addedCount = 0;
            let duplicateCount = 0;
            let errorCount = 0;
            let addedBooks = [];
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<h4>æ‰¹é‡æ·»åŠ ç»“æœï¼š</h4>';
            
            lines.forEach((line, index) => {
                const trimmedLine = line.trim();
                if (!trimmedLine || trimmedLine.startsWith('//') || trimmedLine.startsWith('#')) {
                    return; // è·³è¿‡ç©ºè¡Œå’Œæ³¨é‡Š
                }
                
                // è§£æè¡Œï¼šä¹¦å,ä½œè€…,è´­ä¹°æ—¥æœŸ
                const parts = trimmedLine.split(',').map(part => part.trim());
                const title = parts[0];
                
                if (!title) {
                    errorCount++;
                    resultDiv.innerHTML += `<div style="color: #f44336; margin: 5px 0;">ç¬¬${index + 1}è¡Œï¼šç¼ºå°‘ä¹¦å</div>`;
                    return;
                }
                
                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
                const isDuplicate = books.some(book => 
                    book.title.toLowerCase() === title.toLowerCase()
                ) || addedBooks.some(book => 
                    book.title.toLowerCase() === title.toLowerCase()
                );
                
                if (isDuplicate) {
                    duplicateCount++;
                    resultDiv.innerHTML += `<div style="color: #ff9800; margin: 5px 0;">ç¬¬${index + 1}è¡Œï¼šã€Š${title}ã€‹å·²å­˜åœ¨ï¼Œè·³è¿‡</div>`;
                    return;
                }
                
                // åˆ›å»ºæ–°ä¹¦å¯¹è±¡
                const newBook = {
                    id: Date.now() + index,
                    title: title,
                    author: parts[1] || 'æœªçŸ¥ä½œè€…',
                    purchaseDate: parts[2] || new Date().toISOString().split('T')[0],
                    addDate: new Date().toISOString(),
                    addDateDisplay: new Date().toLocaleDateString('zh-CN')
                };
                
                addedBooks.push(newBook);
                addedCount++;
                resultDiv.innerHTML += `<div style="color: #4CAF50; margin: 5px 0;">ç¬¬${index + 1}è¡Œï¼šã€Š${title}ã€‹æ·»åŠ æˆåŠŸ</div>`;
            });
            
            // å°†æ‰€æœ‰æ–°ä¹¦æ·»åŠ åˆ°ä¹¦åº“
            if (addedBooks.length > 0) {
                const allBooks = [...addedBooks, ...books];
                saveBooks(allBooks);
                
                resultDiv.innerHTML += `<hr style="margin: 15px 0;">
                    <div style="font-weight: bold; margin-top: 10px;">
                        æ‰¹é‡æ·»åŠ å®Œæˆï¼š
                        <span style="color: #4CAF50;">æˆåŠŸæ·»åŠ  ${addedCount} æœ¬</span>ï¼Œ
                        <span style="color: #ff9800;">è·³è¿‡é‡å¤ ${duplicateCount} æœ¬</span>ï¼Œ
                        <span style="color: #f44336;">é”™è¯¯ ${errorCount} è¡Œ</span>
                    </div>`;
                
                // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
                resultDiv.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message, type) {
            // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§æ¶ˆæ¯
            const oldMessage = document.querySelector('.message-alert');
            if (oldMessage) oldMessage.remove();
            
            // åˆ›å»ºæ–°æ¶ˆæ¯
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-alert fade-in`;
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 1000;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                display: flex;
                align-items: center;
                max-width: 400px;
            `;
            
            // æ ¹æ®ç±»å‹è®¾ç½®é¢œè‰²
            if (type === 'success') {
                messageDiv.style.backgroundColor = '#38b000';
            } else if (type === 'warning') {
                messageDiv.style.backgroundColor = '#ff9e00';
            } else if (type === 'error') {
                messageDiv.style.backgroundColor = '#e63946';
            } else {
                messageDiv.style.backgroundColor = '#4361ee';
            }
            
            // æ·»åŠ å›¾æ ‡
            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            else if (type === 'warning') icon = 'exclamation-triangle';
            else if (type === 'error') icon = 'times-circle';
            
            messageDiv.innerHTML = `
                <i class="fas fa-${icon}" style="margin-right: 10px; font-size: 1.2rem;"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(messageDiv);
            
            // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                messageDiv.style.opacity = '0';
                messageDiv.style.transform = 'translateX(100px)';
                messageDiv.style.transition = 'all 0.5s ease';
                
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.parentNode.removeChild(messageDiv);
                    }
                }, 500);
            }, 3000);
        }
    </script>
</body>
</html>